# 📚 1-13 Pydantic과 Request/Response Body

> **학습 목표**: FastAPI에서 Pydantic으로 요청/응답 데이터를 검증한다.

---

## 📋 학습 순서

| 순서 | 파일 | 핵심 내용 |
|:---:|-----|---------|
| 1 | type_hints.py | 타입 힌트 문법 |
| 2 | pydantic_practice.py | BaseModel 기본 |
| 3 | request_body.py | Optional 필드 |
| 4 | response_body.py | 응답 형식 지정 |
| 5 | 과제.py | 에러 처리 |

---

## 1️⃣ 타입 힌트 기초

```python
users: list[dict[str, int | str]] = [
    {"id": 1, "email": "alex@gmail.com"},
]
```

| 표기 | 의미 |
|-----|-----|
| `list[...]` | 리스트 타입 |
| `dict[str, int \| str]` | 딕셔너리 (키=str, 값=int 또는 str) |
| `int \| str` | Union (둘 중 하나) |

---

## 2️⃣ BaseModel 기본

```python
from pydantic import BaseModel

class ItemCreateRequest(BaseModel):
    name: str   # 필수
    price: int  # 필수

@app.post("/items")
def create_item_api(body: ItemCreateRequest):
    return {"name": body.name, "price": body.price}
```

| 동작 | 설명 |
|-----|-----|
| 자동 파싱 | JSON → BaseModel 객체 |
| 자동 검증 | 타입 불일치 → 422 에러 |
| 자동 변환 | 응답 시 JSON으로 변환 |

---

## 3️⃣ Optional 필드

```python
class ItemCreateRequest(BaseModel):
    name: str
    price: int
    description: str | None = None  # 선택적 필드
```

| 표기 | 의미 |
|-----|-----|
| `str \| None` | 문자열 또는 None |
| `= None` | 기본값 None → 필수 아님 |

---

## 4️⃣ Response 모델

```python
class UserSignUpResponse(BaseModel):
    id: int
    email: str
    # password 없음 → 응답에 노출 안 됨!

@app.post("/users/sign-up", status_code=201)
def sign_up_api(body) -> UserSignUpResponse:
    return {"id": 1, "email": body.email}
```

### HTTP 상태 코드

| 코드 | 의미 |
|:---:|-----|
| 200 | OK (기본) |
| 201 | Created (새 리소스 생성) |
| 400 | Bad Request |
| 404 | Not Found |
| 422 | Validation Error |

---

## 5️⃣ 에러 처리

```python
from fastapi import HTTPException

@app.post("/hello")
def hello_api(body: HelloRequest):
    if body.name.strip() == "":
        raise HTTPException(status_code=400, detail="이름을 입력해주세요!")
    return {"message": f"안녕하세요, {body.name}님!"}
```

| 코드 | 역할 |
|-----|-----|
| `strip()` | 앞뒤 공백 제거 |
| `raise HTTPException` | HTTP 에러 발생 |
| `detail` | 에러 메시지 |

---

## 🎓 핵심 정리

### 기억할 패턴

| 패턴 | 용도 |
|-----|-----|
| `xxxRequest` | 요청 데이터 모델 |
| `xxxResponse` | 응답 데이터 모델 |
| `str \| None = None` | Optional 필드 |
| `-> ResponseModel` | 반환 타입 지정 |
| `HTTPException` | 에러 응답 |

### 📌 코드 흐름

| 순서 | 단계 | 설명 |
|:---:|-----|-----|
| 1 | 클라이언트 요청 | JSON 전송 |
| 2 | JSON 파싱 | 문자열 → 딕셔너리 |
| 3 | Pydantic 변환 | 딕셔너리 → 객체 |
| 4 | 타입 검증 | 자동 검증 |
| 5 | 함수 실행 | 비즈니스 로직 |
| 6 | Response 필터링 | 응답 모델에 맞게 |
| 7 | 응답 | JSON 반환 |
